<%- include('../partials/head', { title }) %>
<%- include('../partials/nav') %>
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between">
    <div>
      <h3 class="mb-0">Painel do Patrão</h3>
      <small class="text-muted">Visão consolidada de todas as lojas. Alertas: vence hoje e próximos 2 dias.</small>
    </div>
    <a class="btn btn-primary" href="/bills/new">Cadastrar nova conta</a>
  </div>

  <div class="row g-3 mt-1">
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5>Alertas (urgentes)</h5>
          <div class="mt-3">
            <h6 class="mb-2 text-danger">Vence hoje</h6>
            <% if (organized.today.length === 0) { %>
              <div class="text-muted">Nenhuma conta vencendo hoje.</div>
            <% } else { %>
              <% organized.today.forEach(b => { %>
                <div class="border rounded p-2 mb-2">
                  <div class="d-flex justify-content-between">
                    <div>
                      <div><b><%= b.title %></b></div>
                      <div class="text-muted" style="font-size:13px"><%= b.store_name %> • <%= formatMoneyBRL(b.amount_cents) %></div>
                    </div>
                    <a class="btn btn-sm btn-outline-primary" href="/bills/<%= b.id %>">Ver</a>
                  </div>
                  <% if (b.urgent_today) { %>
                    <span class="badge text-bg-danger mt-2">URGENTE (pagamento do dia)</span>
                  <% } %>
                </div>
              <% }) %>
            <% } %>
          </div>

          <div class="mt-3">
            <h6 class="mb-2">Próximos 2 dias</h6>
            <% if (organized.in2days.length === 0) { %>
              <div class="text-muted">Nenhuma conta nos próximos 2 dias.</div>
            <% } else { %>
              <% organized.in2days.forEach(b => { %>
                <div class="border rounded p-2 mb-2">
                  <div class="d-flex justify-content-between">
                    <div>
                      <div><b><%= b.title %></b></div>
                      <div class="text-muted" style="font-size:13px"><%= b.store_name %> • Vence <%= b.due_date %></div>
                    </div>
                    <a class="btn btn-sm btn-outline-primary" href="/bills/<%= b.id %>">Ver</a>
                  </div>
                </div>
              <% }) %>
            <% } %>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-body">
          <h5>Lojas ativas</h5>
          <% if (stores.length === 0) { %>
            <div class="text-muted">Nenhuma loja cadastrada.</div>
          <% } else { %>
            <ul class="list-group list-group-flush">
              <% stores.forEach(s => { %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <span><%= s.name %></span>
                  <small class="text-muted"><%= s.email || '' %></small>
                </li>
              <% }) %>
            </ul>
          <% } %>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="mb-3">Organização por vencimento</h5>
          <p class="text-muted" style="font-size:13px">Dica: clique em “Ver” para anexar boleto/nota e dar baixa.</p>

          <% function section(title, arr, badgeClass){ %>
            <div class="mt-3">
              <div class="d-flex justify-content-between align-items-center">
                <h6 class="mb-2"><%= title %></h6>
                <span class="badge <%= badgeClass %>"><%= arr.length %></span>
              </div>
              <% if (arr.length === 0) { %>
                <div class="text-muted">—</div>
              <% } else { %>
                <div class="table-responsive">
                  <table class="table table-sm align-middle">
                    <thead>
                      <tr>
                        <th>Loja</th>
                        <th>Débito</th>
                        <th>Vencimento</th>
                        <th>Valor</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <% arr.forEach(b => { %>
                        <tr>
                          <td><%= b.store_name %></td>
                          <td>
                            <%= b.title %>
                            <% if (b.urgent_today) { %>
                              <span class="badge text-bg-danger ms-2">URG</span>
                            <% } %>
                          </td>
                          <td><%= b.due_date %></td>
                          <td><%= formatMoneyBRL(b.amount_cents) %></td>
                          <td class="text-end"><a class="btn btn-sm btn-outline-primary" href="/bills/<%= b.id %>">Ver</a></td>
                        </tr>
                      <% }) %>
                    </tbody>
                  </table>
                </div>
              <% } %>
            </div>
          <% } %>

          <%- section('Vencidas', organized.overdue, 'text-bg-danger') %>
          <%- section('Em até 5 dias', organized.in5days, 'text-bg-warning') %>
          <%- section('Em até 10 dias', organized.in10days, 'text-bg-warning') %>
          <%- section('Em até 15 dias', organized.in15days, 'text-bg-info') %>
          <%- section('Em até 30 dias', organized.in30days, 'text-bg-primary') %>
          <%- section('Em até 60 dias', organized.in60days, 'text-bg-secondary') %>
          <%- section('Mais pra frente', organized.later, 'text-bg-light') %>

        </div>
      </div>
    </div>
  </div>
</div>
<%- include('../partials/foot') %>
